#! /bin/python

from os import path, makedirs
from sys import argv

from load import readGlobAST
from template import renderStructs

if len(argv) != 3:
    print("Usage: ")
    print("lua-json-serde <configs> <outputdir>")
    exit(0)

configGlob = argv[1]
outputDir = argv[2]

if not path.exists(outputDir):
    makedirs(outputDir)

astList = readGlobAST(configGlob)
generatedFiles = []

for ast in astList:
    render = renderStructs(ast)

    filename = ast['filename'] + '.hpp'
    generatedFiles.append(filename)

    file = open(path.join(outputDir, filename), 'w')
    file.write(render)
    file.close()

file = open(path.join(outputDir, 'include_all.hpp'), 'w')
file.writelines(['#include "' + filename + '"' for filename in generatedFiles])
file.close()




